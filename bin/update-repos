#!/bin/bash

if [[ $1 == "pull" ]]; then
    MODE="pull"
else
    MODE="rebase"
fi

function update_dir {
    if [ ! -d "$1/.git" ]; then
        echo -e "\x1B[33mSkip, no git repo\x1B[39m"
        return 0
    fi

    GIT_PULL_OPTS=""
    if [[ $MODE == "rebase" ]]; then
        GIT_PULL_OPTS="--rebase"
    fi

    git --git-dir="$1/.git" --work-tree="$1" pull $GIT_PULL_OPTS
}

echo -e "\x1B[104m\x1B[37mStarting update (mode: $MODE) ...\x1B[39m\x1B[49m"
for dir in $(find $PWD -maxdepth 1 -type d); do
  echo -e "\x1B[32m-> Updating $dir\x1B[39m"
  update_dir $dir
done

echo -e "\x1B[32mdone.\x1B[39m"

